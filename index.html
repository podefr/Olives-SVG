<!doctype html>
<html>
	<head>
		<title>Olives + SVG charting</title>
		<link rel="stylesheet" type="text/css" href="css/chart.css">
	</head>
	<body>
	
		<h1>Olives + SVG charting demo</h1>
	
		<svg  xmlns="http://www.w3.org/2000/svg"
	      xmlns:xlink="http://www.w3.org/1999/xlink">
	      
	      	<g class="grid">
	      		<g data-gridX="foreach">
	      			<line x1 y1="0" x2 y2="200" data-gridx="bind: x1; bind: x2" />
	      		</g>
	      		<g data-gridY="foreach">
	      			<line x1="0" y1 x2="600" y2 data-gridy="bind: y1; bind: y2" />
	      		</g>
	      	</g>
	      	
	      	<g class="chart">
	      		<polygon points="" data-line="bind: drawLine, line" />
	      	</g>
	      	
		</svg>
		
		<form data-event="listen: submit, addPoint">
			<input placeholder="0-200"/>
			<input type="submit" />
		</form>
		
		<script src="libs/require.js"></script>
		<script src="libs/emily.js"></script>
		<script src="libs/olives.js"></script>
		<script src="js/tools.js"></script>
		<script src="js/chart.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/form.js"></script>
		<script>
		
			require(["OSVG/Chart", "OSVG/Grid", "Store", "OSVG/Tools", "OSVG/form", "Observable"], function (Chart, Grid, Store, Tools, Form, Observable) {
				
				var gridY = new Store(Tools.pad([], 20, 10)),
					gridX = new Store(Tools.pad([], 0, 0)),
					chart = new Store({line: [
				                	[0, 200],
				                	[20, 190],
				                	[40, 50],
				                	[60, 160],
				                	[80, 140],
				                	[100, 100],
				                	[120, 80],
				                	[140, 100],
				                	[160, 120],
				                	[160, 200]
					           	]}),
					observable = new Observable;

				Grid(document.querySelector(".grid"), gridX, gridY);
				Chart(document.querySelector(".chart"), chart);
				Form(document.querySelector("form"), observable);
				
				observable.watch("newValue", function (val) {
					if (val >= 0 && val <= 200) {
						// First, get the array that discribes the line (polygon)
						var line = chart.get("line"),
						// We remove the last point which is just to terminate the polygon
						lastValue = line.pop();
						
						// We add the new point, substracted to 200 because of the 'inverted' y axis
						line.push([lastValue[0]+20, 200-val]);
						// And the terminating point
						line.push([lastValue[0]+20, 200]);
						
						chart.set("line", line);
					}
				});
			});
			
		</script>
		
	</body>
</html>