<!doctype html>
<html>
	<head>
		<title>Olives + SVG charting</title>
		<link rel="stylesheet" type="text/css" href="css/chart.css">
	</head>
	<body>
	
		<h1>
			<a href="http://github.com/podefr/Olives-SVG">Olives + SVG charting demo</a>
		</h1>
	
		<svg  xmlns="http://www.w3.org/2000/svg"
	      xmlns:xlink="http://www.w3.org/1999/xlink">
	      
	      	<g class="grid">
	      		<g data-gridx="foreach">
	      			<line x1 y1="0" x2 y2="200" data-gridx="bind: x1; bind: x2" />
	      		</g>
	      		<g data-gridy="foreach">
	      			<line x1="0" y1 x2="600" y2 data-gridy="bind: y1; bind: y2" />
	      		</g>
	      	</g>
	      	
	      	<g class="chart">
	      		<polyline points="" data-line="bind: drawLine, line" />
	      	</g>
	      	
		</svg>
		
		<form data-event="listen: submit, addPoint">
			<input placeholder="0-200"/>
			<input type="submit" />
		</form>
		
		<script src="libs/require.js"></script>
		<script src="libs/Emily.js"></script>
		<script src="libs/Olives.js"></script>
		<script src="js/tools.js"></script>
		<script src="js/chart.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/form.js"></script>
		<script>
		
			require(["OSVG/Chart", "OSVG/Grid", "Store", "OSVG/Tools", "OSVG/form", "Observable"], function (Chart, Grid, Store, Tools, Form, Observable) {
				
				// This is the vertical graduation
				var gridY = new Store(Tools.pad([], 20, 10)),
				// This is the horizontal graduation
				gridX = new Store(Tools.pad([], 0, 0)),
				// "cached" chart values
				chart = new Store({
							line: [ 160, 50, 130, 140, 100, 80, 100, 120 ]
					    }),
				// A mediator would be better for inter UI communication but
				// a bit overkill just now
				observable = new Observable;

				// Initializes the Grid UI by giving a view and additional params
				Grid(document.querySelector(".grid"), gridX, gridY);
				
				// Then the chart by giving a view and a model
				Chart(document.querySelector(".chart"), chart);
				
				// And init the form
				Form(document.querySelector("form"), observable);
				
				// The mediator would be used here
				observable.watch("newValue", function (val) {
					if (val >= 0 && val <= 200) {
						// First, get the array that discribes the line (polygon)
						var line = chart.get("line");
						
						// If there's no more space left
						if (line.length > 31) {
							// Remove the first point
							line.shift();
						}

						// We add the new point, substracted to 200 because of the 'inverted' y axis
						line.push(200-val);
						
						chart.set("line", line);
					}
				});
			});
			
		</script>
		
		<footer>
			Olives SVG charting demo. by 
			<a href="http://github.com/podefr">
				Olivier Scherrer
			</a><br />
			<a href="http://github.com/podefr/Olives-SVG">
				See on github
			</a><br />
			<a href="http://flams.github.com/olives">
				Olives Framework
			</a>
		</footer>
		
		<a href="http://github.com/podefr/Olives-SVG"> <img
alt="Fork me on GitHub"
src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
style="position: fixed; top: 0; right: 0; border: 0;"> </a>
		
	</body>
</html>